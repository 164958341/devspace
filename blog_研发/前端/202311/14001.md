---
title: Cesium中加载大规模数据稳定流畅之性能优化思路
# description: ''
# slug:
# authors:
#  - name:
#    title:
#    url:
#    image_url:
tags: [cesium]
date: 2023-11-14T11:00
hide_table_of_contents: false
# image: ''
---

1、使用数据流技术：Cesium支持使用数据流技术，即按需加载和卸载数据，以最小化数据传输量和加载时间。

在 Cesium 中，Cesium3DTileset#maximumMemoryUsage 属性的作用是控制 3D Tiles 的最大内存使用量，从而在保证数据流畅的前提下尽可能减小内存占用。

实现原理大致如下：

- Cesium 会根据相机位置和高度动态调整 3D Tiles 的细节级别，并将需要渲染的 Tiles 加入渲染队列。

- 当队列中的 Tiles 的内存使用量超过 maximumMemoryUsage 属性设置的最大值时，Cesium 会按照一定的策略卸载一些不必要的 Tiles，以释放内存空间。

- 当相机位置和高度发生变化时，Cesium 会重新计算渲染队列并按需加载新的 Tiles。

- 需要注意的是，maximumMemoryUsage 属性的设置需要根据实际情况进行调整，以平衡内存占用和渲染质量。同时，Cesium 也提供了其他一些控制内存占用和渲染效率的属性和方法，如 Cesium3DTileset#maximumScreenSpaceError 属性等，开发者可以根据实际需求进行选择和配置。

```
 tileset.maximumMemoryUsage = 1024 * 1024 * 1024; // 设置3D Tiles的最大内存使用量
  tileset.maximumScreenSpaceError = 2; // 设置3D Tiles的屏幕空间误差
```

通过以上代码，Cesium会自动按需加载和卸载数据，以最小化数据传输量和加载时间，同时也可以设置一些参数来控制数据的加载和显示。需要注意的是，具体实现还需要根据实际情况进行调整和优化。

2、使用LOD：使用层次细节（LOD）技术，根据相机位置和高度调整3D Tiles的细节级别。这可以帮助减少渲染时间和内存使用。

可以使用 Cesium 的 Cesium3DTileset#maximumScreenSpaceError 属性来控制 3D Tiles 的细节级别。

```
// 设置 LOD
tileset.maximumScreenSpaceError = 2; // 设置 3D Tiles 的屏幕空间误差，控制细节级别
```

通过以上代码，Cesium 会根据相机位置和高度调整 3D Tiles 的细节级别，从而提高渲染效率。需要注意的是，maximumScreenSpaceError 属性的值需要根据实际情况进行调整，以平衡渲染效率和渲染质量。

3、使用Web Workers：使用Web Workers可以将数据处理和渲染任务分离，从而提高性能和响应速度。

4、使用空间索引：使用空间索引可以优化查询和可视化操作。例如，将3D Tiles数据划分为较小的块，并为每个块创建一个索引，以便快速访问和可视化。

5、优化网络带宽：优化网络带宽可以减少数据传输时间和成本。可以使用压缩算法和数据分块等技术来减少数据传输量。

6、合并网格：Cesium 中的合并网格（Merge Mesh）技术可以将多个网格对象合并成一个网格对象，减少渲染调用和 GPU 开销。可以使用 Cesium.MeshMerger API 进行网格合并。


7、纹理合批：在场景中存在大量重复使用的纹理时，可以使用纹理合批（Texture Atlas）技术将多个纹理合并为一个纹理，减少纹理切换次数和 GPU 开销。

8、纹理压缩：对纹理进行压缩，可以减少纹理大小和带宽占用，提高性能。可以使用基于 GPU 的纹理压缩方法，如 ETC1、ETC2、ASTC 等。

9、优化纹理加载：对纹理进行优化，如减小尺寸、使用 MIPMAP 等，可以减小纹理文件的大小，从而提高加载性能。可以使用 Cesium 提供的纹理优化工具或其他第三方工具进行纹理优化。

10、减少数据量：将数据量压缩至最小，使用合适的压缩算法、数据格式和分辨率，可以减小数据大小，加快数据加载和渲染速度。例如，Cesium 中的 3D Tiles 数据格式支持数据分层和压缩，可以通过数据优化工具实现数据的最优化。

11、优化渲染管线：通过优化渲染管线，减少渲染调用和 GPU 开销，可以进一步提高渲染性能。例如，可以使用 GPU 粒子系统、GPU 物理引擎等技术，加速渲染效果。

12、限制场景元素：避免过多的场景元素，例如限制可见区域、限制可见对象数量、控制物体的数量和分布等。

13、缓存机制：使用缓存机制可以避免重复请求，提高数据的加载速度。例如，可以使用浏览器缓存或者使用 Cesium 中的缓存机制。

14、延迟加载：可以延迟数据的加载和渲染，先加载必要的数据和场景元素，等待场景交互事件触发时再加载附加的数据和场景元素，避免一次性加载过多的数据，降低系统负荷。

15、其他优化技巧：例如，禁用一些不必要的功能、使用更低的纹理质量、降低视角切换的频率、减少阴影计算等，都可以提高系统的性能。

16、避免频繁的内存分配：在循环中频繁地创建和销毁对象会导致内存分配和垃圾回收，造成性能损失。可以通过对象池、缓存对象等方法避免频繁的内存分配。

17、使用浏览器的硬件加速：Cesium 采用 WebGL 技术进行图形渲染，浏览器中可以通过启用硬件加速来提高图形渲染性能。可以通过 WebGLRenderingContext.getContextAttributes() 方法获取硬件加速的配置信息。

18、减少帧率：如果场景元素较多，可以适当降低帧率，避免过高的帧率导致卡顿和性能下降。可以使用 viewer.targetFrameRate 属性设置目标帧率。

19、异步加载资源：Cesium 中支持异步加载各种资源，如模型、图片、纹理等。可以使用 Cesium.Resource API 异步加载资源，减少数据加载时间和带宽占用。

20、避免过多的渲染状态切换：过多的渲染状态切换会导致 GPU 开销增加，降低性能。可以合并相同的渲染状态，避免多次状态切换。

21、精简数据：优化数据结构和数据大小，可以降低数据加载和传输时间。可以使用数据压缩、数据转换、数据过滤等方法，精简数据。(这个是处理好是最强的)

22、分批加载：将数据分为多个批次加载，可以避免一次加载过多数据导致的性能问题。可以使用 Cesium.loadJson()、Cesium.loadBlob() 等 API 分批加载数据。

23、精细化控制：对数据加载和渲染进行精细化控制，可以最大限度地提高性能。可以使用 Cesium.LoadingPolicy、Cesium.RenderState、Cesium.ShadowMode 等 API 精细化控制数据加载和渲染。

24、GPU 预处理：对数据进行预处理，以加速 GPU 的渲染，可以提高性能。可以使用 GPU 加速的方法对数据进行处理，如屏幕空间反射（Screen Space Reflection）、环境光遮蔽（Ambient Occlusion）等。

25、渲染层级：使用渲染层级技术，可以避免过度渲染导致的性能问题。可以使用 Cesium.ImageryLayer、Cesium.Primitive、Cesium.Entity 等 API 控制渲染层级。

26、启用硬件加速：启用硬件加速可以提高 Cesium 的性能。可以在浏览器设置中启用硬件加速。

27、使用多级缓存：使用多级缓存可以避免重复加载和渲染相同的数据，提高性能。可以使用 Cesium.Cache、Cesium.Resource 等 API 实现多级缓存。

28、可见性剔除：使用可见性剔除技术，可以避免渲染不可见的数据，提高性能。可以使用 Cesium.CullingVolume、Cesium.IntersectionTests 等 API 实现可见性剔除

29、数据压缩：对数据进行压缩，可以减少带宽占用和加载时间，提高性能。可以使用 GZip、Brotli 等数据压缩算法，或者使用 Cesium 自带的数据压缩方法。

30、基于GPU的渲染：使用基于 GPU 的渲染技术，可以提高渲染性能和用户体验。可以使用 Cesium 中的 Cesium.Renderer API 实现基于 GPU 的渲染。

31、启用硬件加速：启用硬件加速可以提高 Cesium 的性能。可以在浏览器设置中启用硬件加速。

32、使用多级缓存：使用多级缓存可以避免重复加载和渲染相同的数据，提高性能。可以使用 Cesium.Cache、Cesium.Resource 等 API 实现多级缓存。

33、可见性剔除：使用可见性剔除技术，可以避免渲染不可见的数据，提高性能。可以使用 Cesium.CullingVolume、Cesium.IntersectionTests 等 API 实现可见性剔除。

34、基于GPU的渲染：使用基于 GPU 的渲染技术，可以提高渲染性能和用户体验。可以使用 Cesium 中的 Cesium.Renderer API 实现基于 GPU 的渲染。

35、硬件加速的线框模式：使用硬件加速的线框模式，可以提高性能和用户体验。可以使用 Cesium.Primitive 中的线框模式实现硬件加速。

36、GPU Instancing：使用 GPU Instancing 可以提高性能。可以使用 Cesium.GeometryInstance 和 Cesium.Primitive 中的 GPU Instancing 实现硬件加速。

37、预处理数据：对数据进行预处理，如优化模型、精简纹理、删除无用信息等，可以减小数据文件的大小，从而提高加载性能。可以使用 Cesium 的预处理工具或其他第三方工具进行预处理。

38、优化场景管理：对场景进行优化，如分层、剖面、数据过滤等，可以减小数据加载量和渲染时间，提高性能。可以使用 Cesium 提供的场景管理工具或其他第三方工具进行优化。

39、使用数据分段：将数据分成多个段，分别加载和渲染，可以提高加载和渲染的性能。可以使用 Cesium 提供的数据分段功能或其他第三方工具进行数据分段。

40、减小渲染负荷：减小渲染负荷可以提高渲染性能，如减小场景中的对象数、减小纹理尺寸、使用更简单的材质等。可以使用 Cesium 提供的性能分析工具或其他第三方工具分析渲染性能，并进行相应的优化。

41、使用 WebAssembly 技术：将计算任务交给 WebAssembly，可以提高计算性能，从而提高加载和渲染性能。可以使用 Cesium 提供的 WebAssembly 功能或其他第三方工具进行 WebAssembly 开发。等